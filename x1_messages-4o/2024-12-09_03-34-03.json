[
    {
        "role": "user",
        "content": "How can I write a simple smoke test that runs post-deployment to verify the validity of RabbitMQ credentials? Specifically, I'd like to check if the RabbitMQ username, password, and vhost are valid. Preferably, I would like to implement this using a bash script, but a Python script would be a suitable alternative."
    },
    {
        "role": "assistant",
        "content": "To verify the validity of RabbitMQ credentials using a smoke test, you can perform a simple connection check with the RabbitMQ server using either Bash or Python. Below are examples of how you might implement this in both languages.\n\n### Bash Script\n\nYou can use the `curl` command to interact with the RabbitMQ Management HTTP API. This method assumes that the RabbitMQ Management Plugin is enabled.\n\n```bash\n#!/bin/bash\n\n# Credentials and RabbitMQ Management API URL\nRABBITMQ_USER=\"your_username\"\nRABBITMQ_PASS=\"your_password\"\nRABBITMQ_HOST=\"your_rabbitmq_host\"\nRABBITMQ_VHOST=\"your_vhost\"\n\n# Perform a simple GET request to the RabbitMQ Management API\nresponse=$(curl -u $RABBITMQ_USER:$RABBITMQ_PASS -s -o /dev/null -w \"%{http_code}\" http://$RABBITMQ_HOST:15672/api/vhosts/$RABBITMQ_VHOST)\n\n# Check if the response is HTTP 200\nif [ \"$response\" -eq 200 ]; then\n    echo \"RabbitMQ credentials are valid.\"\n    exit 0\nelse\n    echo \"RabbitMQ credentials are invalid or the vhost does not exist.\"\n    exit 1\nfi\n```\n\n### Python Script\n\nFor Python, you can use the `pika` library to perform a connection check.\n\nFirst, make sure you have `pika` installed:\n\n```bash\npip install pika\n```\n\nThen, use the following script:\n\n```python\nimport pika\n\n# Connection parameters\nrabbitmq_user = 'your_username'\nrabbitmq_pass = 'your_password'\nrabbitmq_host = 'your_rabbitmq_host'\nrabbitmq_vhost = 'your_vhost'\n\n# Create a connection parameters object\ncredentials = pika.PlainCredentials(rabbitmq_user, rabbitmq_pass)\nparameters = pika.ConnectionParameters(host=rabbitmq_host, virtual_host=rabbitmq_vhost, credentials=credentials)\n\ntry:\n    # Try to establish a connection\n    connection = pika.BlockingConnection(parameters)\n    connection.close()\n    print(\"RabbitMQ credentials are valid.\")\nexcept pika.exceptions.AMQPError as e:\n    print(\"RabbitMQ credentials are invalid or the vhost does not exist.\")\n    print(f\"Error: {e}\")\n```\n\n### Explanation\n\n- **Bash Script**: The script uses `curl` to make an HTTP request to the RabbitMQ Management API, checking if the provided credentials can access the specified virtual host (`vhost`). A successful HTTP status code (200) indicates valid credentials.\n  \n- **Python Script**: The Python script uses the `pika` library to attempt a connection to RabbitMQ. If the connection is successful, it indicates that the credentials are valid. If it raises an exception, the credentials or the virtual host are likely incorrect.\n\nChoose the script that best fits your deployment environment and integrate it into your post-deployment verification process. Make sure to replace placeholders like `your_username`, `your_password`, `your_rabbitmq_host`, and `your_vhost` with actual values."
    }
]