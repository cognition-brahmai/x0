[
    {
        "role": "user",
        "content": "I am working on a Python program that creates a CSV file from a JSON file. The program opens a JSON file and then goes through it, looking for a specific keyword. If it finds that keyword, it writes everything related to it in a CSV file. I initially had `wb+` as the mode in the `open` function, but that cleared everything each time the file was opened for writing. I replaced that with `a` and now every time it writes, it adds a header. How can I modify my code to ensure that the header is only written once?\n\nThis is the code I'm currently using:\n\nOpening JSON file:\n```python\nf = open('Data.json')\ndata = json.load(f)\nf.close()\n```\n\nSearching for specific keyword and writing to CSV if found:\n```python\nfor item in data:\n    if \"light\" in item:\n       write_light_csv('light.csv', item)\n```\n\n`write_light_csv` function:\n```python\ndef write_light_csv(filename,dic):\n    with open (filename,'a') as csvfile:\n        headers = ['TimeStamp', 'light','Proximity']\n        writer = csv.DictWriter(csvfile, delimiter=',', lineterminator='\\n',fieldnames=headers)\n        writer.writeheader()\n        writer.writerow({'TimeStamp': dic['ts'], 'light' : dic['light'],'Proximity' : dic['prox']})\n```"
    },
    {
        "role": "assistant",
        "content": "To ensure that the header is only written once when writing to a CSV file, you can modify your code to check if the file already exists and is not empty. If it is empty, you write the header; otherwise, you skip writing the header. Here\u2019s how you can achieve it:\n\n1. Check if the file exists and is non-empty before writing the header.\n2. Use a flag to determine whether to write the header.\n\nHere's how you can modify your `write_light_csv` function:\n\n```python\nimport csv\nimport os\n\ndef write_light_csv(filename, dic):\n    file_exists = os.path.isfile(filename)\n    file_empty = os.stat(filename).st_size == 0 if file_exists else True\n    \n    with open(filename, 'a', newline='') as csvfile:\n        headers = ['TimeStamp', 'light', 'Proximity']\n        writer = csv.DictWriter(csvfile, delimiter=',', lineterminator='\\n', fieldnames=headers)\n        \n        # Write the header only if the file is empty\n        if not file_exists or file_empty:\n            writer.writeheader()\n        \n        writer.writerow({'TimeStamp': dic['ts'], 'light': dic['light'], 'Proximity': dic['prox']})\n\n# Example usage\nf = open('Data.json')\ndata = json.load(f)\nf.close()\n\nfor item in data:\n    if \"light\" in item:\n        write_light_csv('light.csv', item)\n```\n\n### Key Changes:\n- **Check File Existence and Size:** Use `os.path.isfile(filename)` to check if the file exists and `os.stat(filename).st_size` to check if the file is non-empty.\n- **Conditional Header Writing:** Write the header using `writer.writeheader()` only if the file is empty or does not exist.\n\nThis approach ensures that the header is written only once, regardless of how many times you append new rows to the CSV file."
    }
]