[
    {
        "role": "user",
        "content": "How can I calculate the age of a person based off the 'dob' column in a pandas dataframe and add a new column to the dataframe with these calculated ages? My current dataframe looks like this:\n\n```python\n    lname      fname     dob\n0    DOE       LAURIE    03011979\n1    BOURNE    JASON     06111978\n2    GRINCH    XMAS      12131988\n3    DOE       JOHN      11121986\n```\n\nI tried using the following code to calculate the age:\n\n```python\nnow = datetime.now()\ndf1['age'] = now - df1['dob']\n```\n\nHowever, I received a TypeError: unsupported operand type(s) for -: 'datetime.datetime' and 'str'. How can I fix this issue?"
    },
    {
        "role": "assistant",
        "content": "To calculate the age of a person based on the 'dob' column in a pandas DataFrame and add a new column with these calculated ages, you need to first convert the 'dob' column from a string format to a datetime object. Once converted, you can calculate the age by subtracting the birthdate from the current date. Here's how you can do it:\n\n```python\nimport pandas as pd\nfrom datetime import datetime\n\n# Sample DataFrame\ndata = {\n    'lname': ['DOE', 'BOURNE', 'GRINCH', 'DOE'],\n    'fname': ['LAURIE', 'JASON', 'XMAS', 'JOHN'],\n    'dob': ['03011979', '06111978', '12131988', '11121986']\n}\n\ndf = pd.DataFrame(data)\n\n# Convert the 'dob' column to datetime format\ndf['dob'] = pd.to_datetime(df['dob'], format='%m%d%Y')\n\n# Calculate age\nnow = datetime.now()\ndf['age'] = df['dob'].apply(lambda dob: now.year - dob.year - ((now.month, now.day) < (dob.month, dob.day)))\n\nprint(df)\n```\n\n### Explanation:\n\n1. **Convert 'dob' to datetime**: We use `pd.to_datetime()` with the specified format `'%m%d%Y'` to convert the 'dob' column from string to datetime.\n\n2. **Calculate age**: We calculate the age by determining the difference in years between the current date and the date of birth. The subtraction `(now.month, now.day) < (dob.month, dob.day)` is used to adjust the age if the birthday hasn't occurred yet this year.\n\nThis code will add a new column 'age' to your DataFrame, containing the calculated ages based on the 'dob' column."
    }
]