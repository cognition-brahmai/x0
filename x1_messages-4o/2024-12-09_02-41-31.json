[
    {
        "role": "user",
        "content": "How can I create a cross-tabulation from a DataFrame with different categorical variables, and have the results displayed as percentages instead of frequencies? I have a dataframe as follows:\n\n```python\ndf = pd.DataFrame({'A' : ['one', 'one', 'two', 'three'] * 6,\n                   'B' : ['A', 'B', 'C'] * 8,\n                   'C' : ['foo', 'foo', 'foo', 'bar', 'bar', 'bar'] * 4,\n                   'D' : np.random.randn(24),\n                   'E' : np.random.randn(24)})\n\npd.crosstab(df.A,df.B)\n```\n\nWhich gives the following output:\n\n```python\nB       A    B    C\nA               \none     4    4    4\nthree   2    2    2\ntwo     2    2    2\n```\n\nI am trying to get the output in this format:\n\n```python\nB       A     B    C\nA               \none     .33  .33  .33\nthree   .33  .33  .33\ntwo     .33  .33  .33\n```\n\nI considered using the margins option in crosstab to compute row and column totals, but I am not sure how to proceed. Is there a way to do this using an aggfunc or groupby?"
    },
    {
        "role": "assistant",
        "content": "To create a cross-tabulation in pandas that displays the results as percentages instead of frequencies, you can first calculate the frequency table using `pd.crosstab()` and then normalize the values to represent percentages. Here\u2019s how you can do it with the given DataFrame:\n\n```python\nimport pandas as pd\nimport numpy as np\n\n# Sample DataFrame\ndf = pd.DataFrame({'A' : ['one', 'one', 'two', 'three'] * 6,\n                   'B' : ['A', 'B', 'C'] * 8,\n                   'C' : ['foo', 'foo', 'foo', 'bar', 'bar', 'bar'] * 4,\n                   'D' : np.random.randn(24),\n                   'E' : np.random.randn(24)})\n\n# Create the initial cross-tabulation\ncrosstab = pd.crosstab(df['A'], df['B'])\n\n# Convert the frequencies to percentages\ncrosstab_percentage = crosstab.div(crosstab.sum(axis=1), axis=0)\n\n# Display the result\nprint(crosstab_percentage)\n```\n\n### Explanation:\n\n1. **Crosstabulation**: We start by creating a basic cross-tabulation of the columns `'A'` and `'B'` using `pd.crosstab(df['A'], df['B'])`. This results in a DataFrame showing the frequency counts.\n\n2. **Normalization**: To convert the frequencies into percentages, you can divide each entry in a row by the sum of that row. This is done using the `div()` function with `axis=0`, which divides each element by the sum of the row it belongs to.\n\n3. **Result**: The resulting DataFrame `crosstab_percentage` now contains the percentage representation of the original frequency counts.\n\nThis will give you the cross-tabulated data with percentages, where each row sums to 1 (or 100% if you multiply by 100). If you want percentages as whole numbers, you can further multiply the result by 100:\n\n```python\n# Optionally multiply by 100 to get percentages as whole numbers\ncrosstab_percentage *= 100\nprint(crosstab_percentage)\n```\n\nThis approach will give you the desired output format."
    }
]