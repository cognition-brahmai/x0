[
    {
        "role": "user",
        "content": "How is the order of items determined in a matplotlib legend? I am trying to plot a legend but the order of the items seems incorrect. The code I am using is as follows:\n\n```python\nfrom pylab import *\nclf()\nax=gca()\nht=ax.add_patch(Rectangle((1,1),1,1,color='r',label='Top',alpha=.1))\nh1=ax.bar(1,2,label='Middle')\nhb=ax.add_patch(Rectangle((1,1),1,1,color='k',label='Bottom',alpha=.11))\nlegend()\nshow()\n```\n\nBut the 'Bottom' appears above 'Middle' in the legend. I thought the order was determined by the creation order of the elements. I am also curious to know what determines the initial order? I can force the order by using the following code, but it seems a bit cumbersome:\n\n```python\nhh=[ht,h1,hb]\nlegend([ht,h1.patches[0],hb],[H.get_label() for H in hh])\n```\n\nCan you provide a more straightforward solution?"
    },
    {
        "role": "assistant",
        "content": "In Matplotlib, the order of items in a legend is determined by the order in which the handle objects are added to the axes, not necessarily the order in which they are created. This is because the legend function by default sorts the handles by the z-order of the artists, with artists with higher z-order appearing on top.\n\nIn your code, the order of the items in the legend is determined by the z-order of the patches and bars. Since the bars (`h1`) are plotted on top of the patches, their default z-order is higher, which is why 'Middle' appears on top of 'Bottom' in the legend.\n\nTo control the order in the legend without manually specifying it, you can explicitly set the z-order of the elements. Here's how you can modify your code to achieve the desired order:\n\n```python\nfrom pylab import *\nclf()\nax = gca()\n\n# Set z-order to control legend order\nht = ax.add_patch(Rectangle((1, 1), 1, 1, color='r', label='Top', alpha=.1, zorder=1))\nh1 = ax.bar(1, 2, label='Middle', zorder=2)\nhb = ax.add_patch(Rectangle((1, 1), 1, 1, color='k', label='Bottom', alpha=.11, zorder=0))\n\n# Create legend\nlegend()\nshow()\n```\n\nBy setting the `zorder` attribute, you ensure that the legend items appear in the order you want. In this example, 'Top' has a z-order of 1, 'Middle' has a z-order of 2, and 'Bottom' has a z-order of 0. This order will be reflected in the legend."
    }
]