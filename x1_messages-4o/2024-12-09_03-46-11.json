[
    {
        "role": "user",
        "content": "How can I access a SharePoint site using the REST API in Python? I have a local SharePoint 2013 site on my VM at the URL \"http://win-5a8pp4v402g/sharepoint_test/site_1/\". When I access this URL from a browser, it asks for my username and password and lets me in. However, when I try to access the site using the REST API in Python with the \"requests\" library, I receive a 401 status code. My code is as follows:\n\n```python\nimport requests\nfrom requests.auth import HTTPBasicAuth\n\nUSERNAME = \"Administrator\"\nPASSWORD = \"password\"\n\nresponse = requests.get(\"http://win-5a8pp4v402g/sharepoint_test/site_1/\", auth=HTTPBasicAuth(USERNAME, PASSWORD))\n\nprint response.status_code\n```\nI'm not sure why I'm getting this error. What could I be missing?\n\nNote: I have been following this article: http://tech.bool.se/using-python-to-request-data-from-sharepoint-via-rest/."
    },
    {
        "role": "assistant",
        "content": "Accessing a SharePoint 2013 site using the REST API in Python can be a bit tricky due to authentication requirements. Here are some common issues and steps you can take to resolve the 401 Unauthorized error:\n\n1. **Authentication Type**:\n   - SharePoint often uses NTLM (Windows Integrated Authentication) rather than basic authentication. The `requests` library's `HTTPBasicAuth` might not work if NTLM is required.\n   - You can use the `requests_ntlm` library for NTLM authentication. Install it using pip:\n\n     ```bash\n     pip install requests_ntlm\n     ```\n\n   - Then, modify your code to use `HttpNtlmAuth`:\n\n     ```python\n     import requests\n     from requests_ntlm import HttpNtlmAuth\n\n     USERNAME = \"WIN-5A8PP4V402G\\\\Administrator\"  # Include the domain\n     PASSWORD = \"password\"\n\n     response = requests.get(\"http://win-5a8pp4v402g/sharepoint_test/site_1/\", auth=HttpNtlmAuth(USERNAME, PASSWORD))\n\n     print(response.status_code)\n     ```\n\n2. **URL Format**:\n   - Ensure that the URL is correct and accessible. Sometimes, the path might need to include specific endpoints or additional paths to the REST API, such as `_api/web`.\n\n3. **Headers**:\n   - You might need to specify custom headers to indicate that you're expecting JSON data. Add headers to your request like this:\n\n     ```python\n     headers = {\n         \"Accept\": \"application/json;odata=verbose\",\n     }\n\n     response = requests.get(\"http://win-5a8pp4v402g/sharepoint_test/site_1/_api/web\", auth=HttpNtlmAuth(USERNAME, PASSWORD), headers=headers)\n\n     print(response.status_code)\n     ```\n\n4. **Firewall and Network**:\n   - Ensure that the VM's firewall settings allow incoming connections to SharePoint.\n   - Check that there are no network issues or proxy settings interfering with the request.\n\n5. **Permissions**:\n   - Verify that the account you are using has the necessary permissions to access the SharePoint site and the REST API.\n\nBy following the above steps, you should be able to successfully authenticate and access your SharePoint site using the REST API in Python."
    }
]