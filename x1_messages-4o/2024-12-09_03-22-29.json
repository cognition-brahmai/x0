[
    {
        "role": "user",
        "content": "I am currently using Airflow and I can manually create or modify connections by navigating through 'Admin -> Connections'. However, I want to be able to do this programmatically through an API. I tried using 'airflow.models.Connection' but it seems to only handle actual connections to the instance instead of saving it to the list. Is there any way to create or modify connections through the Airflow API?"
    },
    {
        "role": "assistant",
        "content": "To programmatically manage connections in Apache Airflow, you can use the Airflow REST API (available from Airflow 2.0 onwards) or interact directly with the Airflow database using Python scripts. Here's how you can do it using both approaches:\n\n### Using the Airflow REST API:\n\n1. **Enable the API:**\n   Make sure your Airflow instance has the API enabled. You can do this by setting `auth_backend` in your `airflow.cfg` file to `airflow.api.auth.backend.basic_auth` or another suitable authentication backend.\n\n2. **Use the API to manage connections:**\n   You can use the `/api/v1/connections` endpoint to create, update, or delete connections. Here are some example curl commands:\n\n   - **Create a connection:**\n     ```bash\n     curl -X POST \"http://<your-airflow-instance>/api/v1/connections\" \\\n       -H \"Content-Type: application/json\" \\\n       -u \"username:password\" \\\n       -d '{\n         \"connection_id\": \"my_connection\",\n         \"conn_type\": \"mysql\",\n         \"host\": \"localhost\",\n         \"schema\": \"my_database\",\n         \"login\": \"my_user\",\n         \"password\": \"my_password\",\n         \"port\": 3306\n       }'\n     ```\n\n   - **Update a connection:**\n     ```bash\n     curl -X PATCH \"http://<your-airflow-instance>/api/v1/connections/my_connection\" \\\n       -H \"Content-Type: application/json\" \\\n       -u \"username:password\" \\\n       -d '{\n         \"host\": \"new_host\"\n       }'\n     ```\n\n### Using Python Script with Airflow Models:\n\nIf you prefer managing connections via a Python script, you can directly use Airflow's ORM to interact with the database:\n\n1. **Create or update a connection:**\n   ```python\n   from airflow.models import Connection\n   from airflow.settings import Session\n\n   # Define your connection\n   new_conn = Connection(\n       conn_id='my_connection',\n       conn_type='mysql',\n       host='localhost',\n       schema='my_database',\n       login='my_user',\n       password='my_password',\n       port=3306\n   )\n\n   # Start a session and add/update the connection\n   session = Session()\n   existing_conn = session.query(Connection).filter_by(conn_id=new_conn.conn_id).first()\n   if existing_conn:\n       session.delete(existing_conn)\n   session.add(new_conn)\n   session.commit()\n   session.close()\n   ```\n\n2. **Run the script:**\n   Ensure that your script runs in the same environment where Airflow is installed, so it has access to the necessary configurations and database.\n\nUsing either of these methods, you should be able to programmatically create or modify connections in Apache Airflow. Choose the one that best fits your workflow and environment setup."
    }
]