[
    {
        "role": "user",
        "content": "How can I load a local model using `torch.hub.load` in PyTorch? I've tried placing the `.pth` file and the `hubconf.py` file in the /tmp/ folder and changed my code to `model = torch.hub.load('/tmp/', 'deeplabv3_resnet101', pretrained=True, source='local')`, but it still downloads the model from the internet. I'm working in a Docker container that has a read-only volume at runtime, which is why the download of new files fails."
    },
    {
        "role": "assistant",
        "content": "When using `torch.hub.load` to load a model locally, it's important to ensure that your `hubconf.py` file and the model weights are set up correctly. If it's still downloading the model from the internet, there might be a few things to check and adjust:\n\n1. **Ensure Correct Directory Structure**: Make sure that your `/tmp/` directory contains a proper `hubconf.py` file. This file should define the `deeplabv3_resnet101` function that returns the model.\n\n2. **Modify `hubconf.py`**: Inside your `hubconf.py`, ensure that the function `deeplabv3_resnet101` is defined to load weights from the local `.pth` file. It might look something like this:\n\n    ```python\n    import torch\n    from torchvision.models.segmentation import deeplabv3_resnet101\n\n    def deeplabv3_resnet101(pretrained=False, **kwargs):\n        model = deeplabv3_resnet101(pretrained=False, **kwargs)\n        if pretrained:\n            model.load_state_dict(torch.load('deeplabv3_resnet101.pth'))\n        return model\n    ```\n\n3. **Check for Absolute Paths**: Ensure that the `.pth` file path in the `load_state_dict` is correct. You may want to use an absolute path to avoid any path issues.\n\n4. **Source Argument**: You are using `source='local'`, which is correct. This tells `torch.hub` to use the local directory.\n\n5. **Pretrained Argument**: Since you are passing `pretrained=True`, ensure that the model weights file (`deeplabv3_resnet101.pth`) is available in the `/tmp/` directory.\n\n6. **Rebuild Docker Image**: If you've made changes to the files, ensure that you rebuild your Docker image to include these changes.\n\nHere's an example of how you might structure your command and files:\n\n- **Directory Structure**:\n    ```\n    /tmp/\n    \u251c\u2500\u2500 hubconf.py\n    \u2514\u2500\u2500 deeplabv3_resnet101.pth\n    ```\n\n- **Loading the Model**:\n    ```python\n    import torch\n\n    model = torch.hub.load('/tmp', 'deeplabv3_resnet101', pretrained=True, source='local')\n    ```\n\nWith these steps, `torch.hub.load` should load the model using the local `.pth` file instead of downloading it. If issues persist, double-check file paths and permissions in your Docker setup."
    }
]