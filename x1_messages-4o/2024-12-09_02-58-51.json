[
    {
        "role": "user",
        "content": "How can I change the download directory in Chrome preferences while using Selenium Webdriver in Python? I'm trying to automate the downloading of thousands of files and want to set Chrome's download folder programmatically. I tried the following code snippet:\n\n```python\nchromepath = '/Users/thiagomarzagao/Desktop/searchcode/chromedriver'\ndesired_caps = {'prefs': {'download': {'default_directory': '/Users/thiagomarzagao/Desktop/downloaded_files/'}}}\ndriver = webdriver.Chrome(executable_path = chromepath, desired_capabilities = desired_caps)\n```\n\nHowever, it's not working as expected. The downloads are still going to the default download folder (\"/Users/thiagomarzagao/Downloads\"). I'm using Python 2.7.5, Selenium 2.2.0, Chromedriver 2.1.210398 on Mac OS X 10.6.8. Any suggestions to resolve this issue?"
    },
    {
        "role": "assistant",
        "content": "To change the download directory in Chrome using Selenium WebDriver in Python, you need to set the preferences correctly in the ChromeOptions object instead of using `desired_capabilities`. Here's an updated version of your code that should work:\n\n```python\nfrom selenium import webdriver\nfrom selenium.webdriver.chrome.service import Service\nfrom selenium.webdriver.chrome.options import Options\n\nchromepath = '/Users/thiagomarzagao/Desktop/searchcode/chromedriver'\ndownload_directory = '/Users/thiagomarzagao/Desktop/downloaded_files/'\n\n# Create an instance of ChromeOptions\nchrome_options = Options()\n\n# Set the download directory preference\nprefs = {'download.default_directory': download_directory}\nchrome_options.add_experimental_option('prefs', prefs)\n\n# Create a service instance with the chromedriver path\nservice = Service(executable_path=chromepath)\n\n# Create a WebDriver instance with the service and options\ndriver = webdriver.Chrome(service=service, options=chrome_options)\n\n# Your further code logic\n\n# Don't forget to close the driver when done\n# driver.quit()\n```\n\n### Key Points:\n1. **ChromeOptions**: Use `Options()` to set browser preferences.\n2. **add_experimental_option**: Use `add_experimental_option` to set the `prefs` dictionary.\n3. **Service**: Use a `Service` object to specify the path to `chromedriver`.\n\nThis configuration should properly set the download directory. Make sure the directory exists and that your script has the necessary permissions to write to it."
    }
]