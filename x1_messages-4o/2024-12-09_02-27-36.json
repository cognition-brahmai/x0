[
    {
        "role": "user",
        "content": "How can I read the target file or directory of a .lnk (shortcut) file using Python? I'm trying to find the \"(My) Videos\" folder on Windows XP and Vista. On XP, it's by default located at \"%HOMEPATH%\\My Documents\\My Videos\", and on Vista it's \"%HOMEPATH%\\Videos\". However, if a user relocates this folder, the \"%HOMEPATH%\\Videos\" folder is replaced by \"%HOMEPATH%\\Videos.lnk\" which points to the new \"My Videos\" folder. I'm looking for a way to retrieve the absolute location of this folder, and I'm open to using Windows-only APIs."
    },
    {
        "role": "assistant",
        "content": "To read the target file or directory of a `.lnk` (shortcut) file in Python, you can use the `pywin32` library, which provides access to the Windows Shell API. This allows you to interact with `.lnk` files and extract their target paths. Here's how you can do it:\n\n1. **Install pywin32**: First, ensure you have the `pywin32` library installed. You can install it using pip:\n\n   ```bash\n   pip install pywin32\n   ```\n\n2. **Read the target of a `.lnk` file**: You can use the following script to read the target path of a shortcut file:\n\n   ```python\n   import os\n   import pythoncom\n   from win32com.shell import shell, shellcon\n\n   def get_shortcut_target(path):\n       # Initialize the COM libraries\n       pythoncom.CoInitialize()\n\n       # Create a shell link object\n       shell_link = pythoncom.CoCreateInstance(\n           shell.CLSID_ShellLink,\n           None,\n           pythoncom.CLSCTX_INPROC_SERVER,\n           shell.IID_IShellLink\n       )\n\n       # Load the shortcut file\n       persist_file = shell_link.QueryInterface(pythoncom.IID_IPersistFile)\n       persist_file.Load(path)\n\n       # Get the target path\n       target_path = shell_link.GetPath(shell.SLGP_UNCPRIORITY)\n       return target_path[0]  # target_path is a tuple (path, find_data, flags)\n\n   # Example usage\n   user_home = os.path.expanduser(\"~\")\n   videos_lnk_path = os.path.join(user_home, \"Videos.lnk\")\n\n   if os.path.exists(videos_lnk_path):\n       target = get_shortcut_target(videos_lnk_path)\n       print(f\"The target of '{videos_lnk_path}' is '{target}'\")\n   else:\n       print(\"Videos.lnk does not exist.\")\n\n   # Clean up the COM libraries\n   pythoncom.CoUninitialize()\n   ```\n\nThis script initializes the COM libraries, uses the `IShellLink` interface to interact with the `.lnk` file, and retrieves the target path. Make sure to replace `videos_lnk_path` with the actual path to the `.lnk` file you want to resolve.\n\nThis approach will work on both Windows XP and Vista, and should also be compatible with later versions of Windows, allowing you to retrieve the correct location of the \"My Videos\" folder even if it's been relocated by the user."
    }
]