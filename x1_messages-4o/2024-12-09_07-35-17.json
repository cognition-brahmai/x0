[
    {
        "role": "user",
        "content": "I am attempting to utilize Amazon's new SMTP service for SES with Django 1.3.1. I have generated my SES SMTP credentials and updated them in my Django settings as shown below:\n\n```\nEMAIL_USE_TLS = True\nEMAIL_HOST = 'email-smtp.us-east-1.amazonaws.com'\nEMAIL_HOST_USER = 'my-smtp-user'\nEMAIL_HOST_PASSWORD = 'my-smtp-password'\nEMAIL_PORT = 465\n```\n\nI tried sending a test email to and from verified email addresses with the following code:\n\n```\nfrom django.core.mail import send_mail\nsend_mail('Test subject', 'This is the body', 'info@abc.com',['hello@abc.com'], fail_silently=False)\n```\n\nHowever, I received the following error: `SMTPServerDisconnected: Connection unexpectedly closed`. Upon attempting to telnet to the server with `telnet email-smtp.us-east-1.amazonaws.com 465`, I was able to connect. What could be the issue and how can I resolve this?"
    },
    {
        "role": "assistant",
        "content": "The error you're encountering, `SMTPServerDisconnected: Connection unexpectedly closed`, often occurs when there's a mismatch between the email settings and the server's expected configuration. In your case, the issue might be related to the use of port 465 with `EMAIL_USE_TLS = True`. Port 465 is traditionally used for SMTP over SSL (SMTPS), which is different from TLS.\n\nTo resolve this, you can try the following steps:\n\n1. **Use the Correct Port and Protocol:**\n   - For TLS, use port 587 instead of 465. Port 587 is the standard port for email submission using TLS.\n   - Update your settings as follows:\n     ```python\n     EMAIL_USE_TLS = True\n     EMAIL_PORT = 587\n     ```\n\n2. **Alternatively, Use SSL:**\n   - If you specifically want to use port 465, you need to use SSL instead of TLS. Update your settings to use SSL:\n     ```python\n     EMAIL_USE_SSL = True\n     EMAIL_PORT = 465\n     ```\n\n3. **Avoid Using Both TLS and SSL:**\n   - Ensure that you are not setting both `EMAIL_USE_TLS` and `EMAIL_USE_SSL` to `True` at the same time. Choose one based on the port you're using.\n\n4. **Check SMTP Credentials:**\n   - Double-check your SMTP credentials (`EMAIL_HOST_USER` and `EMAIL_HOST_PASSWORD`) to ensure they are correct.\n\n5. **Firewall and Network Settings:**\n   - Ensure that there are no firewall or network rules blocking outgoing connections to the SMTP server on the specified port.\n\n6. **Verify SES Configuration:**\n   - Make sure that the email addresses you're using have been verified in your SES account, and your SES account is out of the sandbox mode if you intend to send emails to unverified addresses.\n\nAfter making these changes, try sending a test email again. If you continue to experience issues, review any additional error messages for more specific troubleshooting steps."
    }
]