[
    {
        "role": "user",
        "content": "I have an installation of miniconda3 and I've created a virtual environment called py35. I have some libraries located in /.../miniconda3/envs/py35/libs that I only want to use within this environment. However, these libraries are not found from within the environment as the LD_LIBRARY_PATH does not contain the mentioned folder. How can I set LD_LIBRARY_PATH to include the /lib only when I am in the virtual environment? Should I modify the activate script that miniconda uses to start the environment or is there a standard practice to achieve this?"
    },
    {
        "role": "assistant",
        "content": "To ensure that your custom libraries are included in the `LD_LIBRARY_PATH` only when your `py35` virtual environment is active, modifying the activation and deactivation scripts for the environment is a practical approach. Here\u2019s how you can do it:\n\n### Step 1: Modify the Activation Script\n\n1. **Locate the Activation Script:**\n\n   When you activate your conda environment, it runs a script located in the `etc/conda/activate.d/` directory inside your environment. You can create a custom script there if it doesn\u2019t already exist.\n\n   ```bash\n   mkdir -p /path/to/miniconda3/envs/py35/etc/conda/activate.d\n   touch /path/to/miniconda3/envs/py35/etc/conda/activate.d/env_vars.sh\n   ```\n\n2. **Edit the Script:**\n\n   Add the following lines to `env_vars.sh` to set the `LD_LIBRARY_PATH`:\n\n   ```bash\n   #!/bin/bash\n   export OLD_LD_LIBRARY_PATH=\"$LD_LIBRARY_PATH\"\n   export LD_LIBRARY_PATH=\"/path/to/miniconda3/envs/py35/libs:$LD_LIBRARY_PATH\"\n   ```\n\n### Step 2: Modify the Deactivation Script\n\n1. **Locate the Deactivation Script:**\n\n   You will also need to reset `LD_LIBRARY_PATH` when you deactivate the environment. Create a script in the `etc/conda/deactivate.d/` directory.\n\n   ```bash\n   mkdir -p /path/to/miniconda3/envs/py35/etc/conda/deactivate.d\n   touch /path/to/miniconda3/envs/py35/etc/conda/deactivate.d/env_vars.sh\n   ```\n\n2. **Edit the Script:**\n\n   Add the following lines to the `env_vars.sh` in the deactivation directory:\n\n   ```bash\n   #!/bin/bash\n   export LD_LIBRARY_PATH=\"$OLD_LD_LIBRARY_PATH\"\n   unset OLD_LD_LIBRARY_PATH\n   ```\n\n### Explanation\n\n- **Activation Script:** This script is executed when you activate the environment. It backs up the existing `LD_LIBRARY_PATH` to a temporary environment variable (`OLD_LD_LIBRARY_PATH`) and then prepends your custom library path.\n\n- **Deactivation Script:** This script is executed when you deactivate the environment. It restores the `LD_LIBRARY_PATH` to its original state using the backed-up value.\n\n### Additional Notes\n\n- Always use absolute paths in the scripts.\n- Ensure that your scripts are executable. You can set the executable permission using:\n\n  ```bash\n  chmod +x /path/to/miniconda3/envs/py35/etc/conda/activate.d/env_vars.sh\n  chmod +x /path/to/miniconda3/envs/py35/etc/conda/deactivate.d/env_vars.sh\n  ```\n\nThis method ensures that your library path is updated only when the environment is active and restores the original path upon deactivation."
    }
]