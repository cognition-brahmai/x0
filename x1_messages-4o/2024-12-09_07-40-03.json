[
    {
        "role": "user",
        "content": "How can I get form data in Flask? I have created a form using JavaScript, and I need to fetch data from the input field named 'json'. When I try to get the data from this input field in my view function, I encounter a KeyError: 'json'. Here's the code I'm using:\n\nJavaScript Form Creation:\n```javascript\n<script>   \nfunction checkAuth() {\n    var user = ADAL.getCachedUser();\n    if (user) {\n        var form = $('<form style=\"position: absolute; width: 0; height: 0; opacity: 0; display: none; visibility: hidden;\" method=\"POST\" action= \"{{ url_for(\"general.microsoft\") }}\">');\n\n        form.append('<input type=\"hidden\" name=\"token\" value=\"' + ADAL.getCachedToken(ADAL.config.clientId) + '\">');\n        form.append('<input type=\"hidden\" name=\"json\" value=\"' + encodeURIComponent(JSON.stringify(user)) + '\">');\n        $(\"body\").append(form);\n        form.submit();\n    }\n}\n</script>\n```\n\nFlask View Function:\n```python\n@general.route(\"/microsoft/\", methods=[\"GET\", \"POST\"])\n@csrf.exempt\ndef microsoft():\n    form = cgi.FieldStorage()\n    name = form['json'].value\n    return name\n```\n\nError:\n```python\nbuiltins.KeyError KeyError: 'json'\n```\nHow can I correctly access the form data in Flask?"
    },
    {
        "role": "assistant",
        "content": "To access form data in Flask, you should avoid using `cgi.FieldStorage()` as it is not necessary when using Flask. Instead, Flask provides a convenient way to access form data through the `request` object. Here's how you can modify your Flask view function to correctly access the data from the form:\n\n1. Ensure you have imported the `request` object from Flask.\n\n2. Access the form data using `request.form` which is a dictionary-like object that contains the form data submitted via a POST request.\n\nHere's your updated Flask view function:\n\n```python\nfrom flask import request, jsonify\n\n@general.route(\"/microsoft/\", methods=[\"GET\", \"POST\"])\n@csrf.exempt\ndef microsoft():\n    if request.method == \"POST\":\n        # Access the form data using request.form\n        name = request.form.get('json')\n        \n        # If you want to decode the JSON string back into a Python object\n        if name:\n            user_data = json.loads(name)\n            return jsonify(user_data)  # Return the user data as JSON response\n\n    return \"No data received\"\n```\n\n### Key Points:\n\n- Use `request.form.get('json')` to safely access the form data. This will return `None` if the key does not exist, avoiding a `KeyError`.\n\n- If the data in the 'json' field is a JSON string, you can convert it back to a Python dictionary using `json.loads()`.\n\n- Make sure the form is properly submitted and the `name` attribute in the input field matches the one you are trying to access in the Flask view.\n\n- Ensure that your JavaScript code correctly adds the form to the body and submits it.\n\nWith these changes, your Flask application should be able to correctly handle the form data submitted from your JavaScript."
    }
]