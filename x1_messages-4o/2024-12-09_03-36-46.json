[
    {
        "role": "user",
        "content": "I am trying to modify the mplot3d example code to add a colorbar to my 3D surface plot. I am using matplotlib's plot_surface command to create the plot, but when I try to add a colorbar using fig.colorbar(), I encounter an error. The error message is: \"TypeError: You must first set_array for mappable\". How can I resolve this issue and successfully add a colorbar to my 3D plot? Here is the code I am currently using:\n\n```python\nfrom mpl_toolkits.mplot3d import Axes3D\nimport matplotlib.pyplot as plt\nimport numpy as np\n\nfig = plt.figure()\nax = fig.add_subplot(111, projection='3d')\n\nu = np.linspace(0, 2 * np.pi, 100)\nv = np.linspace(0, np.pi, 100)\n\nx = 10 * np.outer(np.cos(u), np.sin(v))\ny = 10 * np.outer(np.sin(u), np.sin(v))\nz = 10 * np.outer(np.ones(np.size(u)), np.cos(v))\nz1 = z * np.cos(0.5*x)\n\nN = z1 / z1.max()  # normalize 0..1\nsurf = ax.plot_surface(x, y, z, rstride=1, cstride=1, facecolors=cm.jet(N), linewidth=0, antialiased=False, shade=False)\n\nfig.colorbar(surf, shrink=0.5, aspect=5)\nplt.show()\n```\n\nAnd here is the full error traceback:\n\n```python\nTraceback (most recent call last):\n  File \"<ipython console>\", line 1, in <module>\n  File \"C:\\Python26\\lib\\site-packages\\spyderlib\\widgets\\externalshell\\startup.py\", line 122, in runfile\n    execfile(filename, glbs)\n File \"C:\\Documents and Settings\\mramacha\\My Documents\\Python\\Candela\\test.py\", line 22, in <module>\n    fig.colorbar(surf, shrink=0.5, aspect=5)\n  File \"C:\\Python26\\lib\\site-packages\\matplotlib\\figure.py\", line 1104, in colorbar\n    cb = cbar.Colorbar(cax, mappable, **kw)\n  File \"C:\\Python26\\lib\\site-packages\\matplotlib\\colorbar.py\", line 706, in __init__\n    mappable.autoscale_None() # Ensure mappable.norm.vmin, vmax\n  File \"C:\\Python26\\lib\\site-packages\\matplotlib\\cm.py\", line 261, in autoscale_None\n    raise TypeError('You must first set_array for mappable')\nTypeError: You must first set_array for mappable\n```"
    },
    {
        "role": "assistant",
        "content": "The error you're encountering is because the `plot_surface` method returns a `Poly3DCollection`, which does not directly support color map scaling in the way that a `ScalarMappable` object does. To add a colorbar to your 3D surface plot, you need to use the `plot_surface` method's `cmap` argument to apply a colormap directly, and then specify that `surf` is the mappable object for the colorbar.\n\nHere's how you can modify your code:\n\n```python\nfrom mpl_toolkits.mplot3d import Axes3D\nimport matplotlib.pyplot as plt\nimport numpy as np\nfrom matplotlib import cm\n\nfig = plt.figure()\nax = fig.add_subplot(111, projection='3d')\n\nu = np.linspace(0, 2 * np.pi, 100)\nv = np.linspace(0, np.pi, 100)\n\nx = 10 * np.outer(np.cos(u), np.sin(v))\ny = 10 * np.outer(np.sin(u), np.sin(v))\nz = 10 * np.outer(np.ones(np.size(u)), np.cos(v))\nz1 = z * np.cos(0.5*x)\n\n# Normalize z1 for coloring\nnorm = plt.Normalize(z1.min(), z1.max())\nsurf = ax.plot_surface(x, y, z, rstride=1, cstride=1, facecolors=cm.jet(norm(z1)), linewidth=0, antialiased=False, shade=False)\n\n# Create a ScalarMappable and add a colorbar\nmappable = cm.ScalarMappable(cmap=cm.jet, norm=norm)\nmappable.set_array(z1)\nfig.colorbar(mappable, shrink=0.5, aspect=5)\n\nplt.show()\n```\n\n### Key Changes:\n1. **Normalization**: Use `plt.Normalize()` to normalize the values of `z1` for the colormap.\n2. **ScalarMappable**: Create a `ScalarMappable` with the same colormap (`cm.jet`) and normalization, and set its array to `z1`.\n3. **Colorbar**: Pass the `ScalarMappable` to `fig.colorbar()` to generate the colorbar.\n\nThis approach will resolve the error and add a functional colorbar to your 3D plot."
    }
]