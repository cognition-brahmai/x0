[
    {
        "role": "user",
        "content": "How can I use pandas to write to an existing Excel file without overwriting the data? I have a file named 'Masterfile.xlsx' with several tabs, but it does not yet contain a tab named \"Main\". I used the following code to write to the \"Main\" sheet:\n\n```python\nimport pandas\n\nwriter = pandas.ExcelWriter('Masterfile.xlsx') \ndata_filtered.to_excel(writer, \"Main\", cols=['Diff1', 'Diff2'])\nwriter.save()\n```\nHowever, while pandas correctly writes to the \"Main\" sheet, it deletes all the other tabs. How can I prevent this from happening?"
    },
    {
        "role": "assistant",
        "content": "To write to an existing Excel file without overwriting the existing sheets, you can use the `openpyxl` engine with `pandas.ExcelWriter`. This allows you to open an existing workbook and add new sheets to it without deleting the existing ones. Here's how you can modify your code to achieve that:\n\n```python\nimport pandas as pd\nfrom openpyxl import load_workbook\n\n# Load the existing workbook\nbook = load_workbook('Masterfile.xlsx')\n\n# Create an ExcelWriter object using the loaded workbook\nwith pd.ExcelWriter('Masterfile.xlsx', engine='openpyxl') as writer:\n    writer.book = book\n    writer.sheets = {ws.title: ws for ws in book.worksheets}\n\n    # Write the DataFrame to a new sheet\n    data_filtered.to_excel(writer, sheet_name='Main', index=False, columns=['Diff1', 'Diff2'])\n\n    # Save the workbook\n    writer.save()\n```\n\n### Key Points:\n\n- **Load the Workbook:** Use `load_workbook()` from `openpyxl` to load the existing Excel file.\n- **Use `ExcelWriter`:** Specify `engine='openpyxl'` in `ExcelWriter` and pass the loaded workbook to the writer.\n- **Access Existing Sheets:** Initialize `writer.sheets` with the current sheets in the workbook, so they are not deleted when saving.\n- **Write to New Sheet:** Write the DataFrame to the new sheet using `to_excel()`. Ensure the `sheet_name` is set to the name of the new sheet.\n- **Avoid Overwriting:** The writer handles adding new data without overwriting existing sheets.\n\nThis method ensures that you can add new data to a new sheet without affecting the existing sheets in your Excel file."
    }
]