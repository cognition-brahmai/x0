[
    {
        "role": "user",
        "content": "I am using the Python `requests` library to maintain Python 2 & 3 compatibility and simplify my application requests management. I have a case where I need to parse a URL and replace one of its parameters. For instance, I need to replace the 'token' parameter in the URL http://example.com?param1=a&token=TOKEN_TO_REPLACE&param2=c with a new token, obtaining the result http://example.com?param1=a&token=NEW_TOKEN&param2=c. I can achieve this with the `urllib` library as shown. How can I achieve the same using the `requests` library?"
    },
    {
        "role": "assistant",
        "content": "The `requests` library in Python is primarily used for making HTTP requests and does not have built-in functions for parsing and modifying URLs. However, you can still achieve the desired outcome by using a combination of `requests` and Python's standard `urllib` libraries to modify the URL parameters. Here's how you can do it using `urllib.parse`:\n\n```python\nimport requests\nfrom urllib.parse import urlparse, parse_qs, urlencode, urlunparse\n\n# Original URL\nurl = \"http://example.com?param1=a&token=TOKEN_TO_REPLACE&param2=c\"\n\n# Parse the URL into components\nparsed_url = urlparse(url)\n\n# Parse the query parameters into a dictionary\nquery_params = parse_qs(parsed_url.query)\n\n# Replace the 'token' parameter\nquery_params['token'] = 'NEW_TOKEN'\n\n# Construct the new query string\nnew_query_string = urlencode(query_params, doseq=True)\n\n# Construct the new URL with the updated query string\nnew_url = urlunparse(parsed_url._replace(query=new_query_string))\n\nprint(new_url)\n```\n\nThis code snippet does the following:\n\n1. Parses the original URL using `urlparse`.\n2. Extracts and parses the query parameters using `parse_qs`, which returns a dictionary where keys are parameter names and values are lists of parameter values.\n3. Replaces the value of the 'token' parameter.\n4. Constructs a new query string using `urlencode`, ensuring the `doseq=True` argument is set to properly format parameters with multiple values.\n5. Reconstructs the full URL with the updated query parameters using `urlunparse`.\n\nThis will give you the desired URL with the updated 'token' parameter."
    }
]