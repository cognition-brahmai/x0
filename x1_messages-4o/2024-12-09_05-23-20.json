[
    {
        "role": "user",
        "content": "I recently started using Airflow and I need assistance with passing a parameter into PythonOperator. I have a task id 't5_send_notification' and a Python callable SendEmail. I want to pass some parameters into the callable 'SendEmail' of 't5_send_notification' ideally to attach the full log or part of the log from the kwargs to the email to be sent out. Here's my code:\n\n```python\nt5_send_notification = PythonOperator(\n    task_id='t5_send_notification',\n    provide_context=True,\n    python_callable=SendEmail,\n    op_kwargs=None,\n    #op_kwargs=(key1='value1', key2='value2'),\n    dag=dag,\n)\n\ndef SendEmail(**kwargs):\n    msg = MIMEText(\"The pipeline for client1 is completed, please check.\")\n    msg['Subject'] = \"xxxx\"\n    msg['From'] = \"xxxx\"\n    ......\n    s = smtplib.SMTP('localhost')\n    s.send_message(msg)\n    s.quit()\n```\nHow can I achieve this?"
    },
    {
        "role": "assistant",
        "content": "To pass parameters into the `SendEmail` callable using the `PythonOperator`, you can utilize the `op_kwargs` parameter to pass keyword arguments. You can then access these arguments within your `SendEmail` function.\n\nHere's how you can modify your code to achieve this:\n\n1. Define the `op_kwargs` with the key-value pairs that you want to pass to the `SendEmail` function.\n2. Access these parameters in the `SendEmail` function using the `kwargs` dictionary.\n\nHere's the updated code:\n\n```python\nfrom airflow.operators.python import PythonOperator\nfrom email.mime.text import MIMEText\nimport smtplib\n\ndef SendEmail(**kwargs):\n    # Access the parameters passed via op_kwargs\n    log_info = kwargs.get('log_info', 'No log info provided')\n    additional_info = kwargs.get('additional_info', 'No additional info provided')\n\n    # Create the email content\n    msg = MIMEText(f\"The pipeline for client1 is completed, please check.\\n\\nLog Info: {log_info}\\nAdditional Info: {additional_info}\")\n    msg['Subject'] = \"Pipeline Completion Notification\"\n    msg['From'] = \"your_email@example.com\"\n    msg['To'] = \"recipient_email@example.com\"\n\n    # Send the email\n    s = smtplib.SMTP('localhost')\n    s.send_message(msg)\n    s.quit()\n\n# Define the op_kwargs with parameters you want to pass\nop_kwargs = {\n    'log_info': 'Here is the log info you wanted to include.',\n    'additional_info': 'Any other additional information'\n}\n\n# Create the PythonOperator with the op_kwargs\nt5_send_notification = PythonOperator(\n    task_id='t5_send_notification',\n    provide_context=True,\n    python_callable=SendEmail,\n    op_kwargs=op_kwargs,  # Pass the op_kwargs here\n    dag=dag,\n)\n```\n\nIn this example, `log_info` and `additional_info` are passed as keyword arguments to the `SendEmail` function. You can modify these parameters according to your needs."
    }
]