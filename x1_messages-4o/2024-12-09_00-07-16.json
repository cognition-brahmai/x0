[
    {
        "role": "user",
        "content": "How can I create a dynamic table in HTML using JavaScript that contains 10 movie titles with columns for title, director, release year, budget, box office gross, and genre, where the budget and box office gross columns will automatically calculate the difference and percentage increase or decrease? Additionally, how can I include a table that shows the average box office gross for each genre, sorted in descending order? Here's an example of how the table should look:\n<table id=\"movie-table\">\n  <thead>\n    <tr>\n      <th>Title</th>\n      <th>Director</th>\n      <th>Release Year</th>\n      <th>Budget</th>\n      <th>Box Office Gross</th>\n      <th>Genre</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>The Godfather</td>\n      <td>Francis Ford Coppola</td>\n      <td>1972</td>\n      <td>$6M</td>\n      <td>$246M (+$240M, +4000%)</td>\n      <td>Crime, Drama</td>\n    </tr>\n    <tr>\n      <td>Star Wars</td>\n      <td>George Lucas</td>\n      <td>1977</td>\n      <td>$11M</td>\n      <td>$775M (+$764M, +7000%)</td>\n      <td>Science Fiction, Action</td>\n    </tr>\n    <tr>\n      <td>Titanic</td>\n      <td>James Cameron</td>\n      <td>1997</td>\n      <td>$200M</td>\n      <td>$2.2B (+$2B, +1000%)</td>\n      <td>Romance, Drama</td>\n    </tr>\n    <tr>\n      <td>The Shawshank Redemption</td>\n      <td>Frank Darabont</td>\n      <td>1994</td>\n      <td>$25M</td>\n      <td>$58M (+$33M, +132%)</td>\n      <td>Drama</td>\n    </tr>\n    <tr>\n      <td>Pulp Fiction</td>\n      <td>Quentin Tarantino</td>\n      <td>1994</td>\n      <td>$8M</td>\n      <td>$213M (+$205M, +2500%)</td>\n      <td>Crime, Thriller</td>\n    </tr>\n    <!-- more movie rows -->\n  </tbody>\n</table>\n[JavaScript code]:\nconst movies = [\n  { title: \"The Godfather\", director: \"Francis Ford Coppola\", release_year: 1972, budget: 6, box_office_gross: 246, genre: [\"Crime\", \"Drama\"] },\n  { title: \"Star Wars\", director: \"George Lucas\", release_year: 1977, budget: 11, box_office_gross: 775, genre: [\"Science Fiction\", \"Action\"] },\n  { title: \"Titanic\", director: \"James Cameron\", release_year: 1997, budget: 200, box_office_gross: 2200, genre: [\"Romance\", \"Drama\"] },\n  { title: \"The Shawshank Redemption\", director: \"Frank Darabont\", release_year: 1994, budget: 25, box_office_gross: 58, genre: [\"Drama\"] },\n  { title: \"Pulp Fiction\", director: \"Quentin Tarantino\", release_year: 1994, budget: 8, box_office_gross: 213, genre: [\"Crime\", \"Thriller\"] },\n  // more movie objects\n];\n// create movie table\nconst movieTable = document.createElement(\"table\");\nmovieTable.id = \"movie-table\";\n// create table header\nconst tableHeader = document.createElement(\"thead\");\nconst headerRow = document.createElement(\"tr\");\n[\"Title\", \"Director\", \"Release Year\", \"Budget\", \"Box Office Gross\", \"Genre\"].forEach(headerText => {\n  const header = document.createElement(\"th\");\n  header.textContent = headerText;\n  headerRow.appendChild(header);\n});\ntableHeader.appendChild(headerRow);\nmovieTable.appendChild(tableHeader);\n// create table body\nconst tableBody = document.createElement(\"tbody\");\nmovies.forEach(movie => {\n  const row = document.createElement(\"tr\");\n  const { title, director, release_year, budget, box_office_gross, genre } = movie;\n  \n  // create table cells\n  const titleCell = document.createElement(\"td\");\n  const directorCell = document.createElement(\"td\");\n  const yearCell = document.createElement(\"td\");\n  const budgetCell = document.createElement(\"td\");\n  const boxOfficeCell = document.createElement(\"td\");\n  const genreCell = document.createElement(\"td\");\n  \n  // set cell values\n  titleCell.textContent = title;\n  directorCell.textContent = director;\n  yearCell.textContent = release_year;\n  budgetCell.textContent = \"$\" + budget + \"M\";\n  boxOfficeCell.textContent = \"$\" + box_office_gross + \"M\";\n  genreCell.textContent = genre.join(\", \");\n  \n  // add cells to row\n  row.appendChild(titleCell);\n  row.appendChild(directorCell);\n  row.appendChild(yearCell);\n  row.appendChild(budgetCell);\n  row.appendChild(boxOfficeCell);\n  row.appendChild(genreCell);\n  \n  // add row to table body\n  tableBody.appendChild(row);\n});\nmovieTable.appendChild(tableBody);\n// add table to page\ndocument.body.appendChild(movieTable);\n// calculate budget difference and percentage increase/decrease\nmovies.forEach(movie => {\n  const { budget, box_office_gross } = movie;\n  const difference = box_office_gross - budget;\n  const percentage = Math.round((difference / budget) * 10000) / 100;\n  movie.box_office_gross = \"$\" + box_office_gross + \"M (+\" + difference + \"M, \" + (percentage >= 0 ? \"+\" : \"\") + percentage + \"%)\";\n});\n// create pivot table\nconst pivotTableData = [[\"Genre\", \"Box Office Gross\"]];\nconst genreData = {};\nmovies.forEach(movie => {\n  movie.genre.forEach(genre => {\n    genreData[genre] = genreData[genre] || { count: 0, total: 0 };\n    genreData[genre].count++;\n    genreData[genre].total += movie.box_office_gross;\n  });\n});\nObject.entries(genreData)\n  .map(([genre, data]) => [genre, data.total / data.count])\n  .sort((a, b) => b[1] - a[1])\n  .forEach(([genre, averageBoxOffice]) => {\n    pivotTableData.push([genre, \"$\" + averageBoxOffice.toFixed(2) + \"M\"]);\n  });\nconst pivotTable = document.createElement(\"table\");\npivotTable.id = \"pivot-table\";\nconst pivotTableHeader = document.createElement(\"thead\");\nconst pivotTableHeaderRow = document.createElement(\"tr\");\n[\"Genre\", \"Average Box Office Gross\"].forEach(headerText => {\n  const header = document.createElement(\"th\");\n  header.textContent = headerText;\n  pivotTableHeaderRow.appendChild(header);\n});\npivotTableHeader.appendChild(pivotTableHeaderRow);\npivotTable.appendChild(pivotTableHeader);\nconst pivotTableBody = document.createElement(\"tbody\");\npivotTableData.forEach((rowData, i) => {\n  const row = document.createElement(\"tr\");\n  rowData.forEach(cellData => {\n    const cell = document.createElement(i === 0 ? \"th\" : \"td\");\n    cell.textContent = cellData;\n    row.appendChild(cell);\n  });\n  pivotTableBody.appendChild(row);\n});\npivotTable.appendChild(pivotTableBody);\ndocument.body.appendChild(pivotTable);\n// hide pivot table initially\npivotTable.style.display = \"none\";\n// toggle pivot table visibility on button click\nconst toggleButton = document.createElement(\"button\");\ntoggleButton.textContent = \"Toggle Pivot Table\";\ntoggleButton.addEventListener(\"click\", () => {\n  pivotTable.style.display = pivotTable.style.display === \"none\" ? \"\" : \"none\";\n});\ndocument.body.appendChild(toggleButton);"
    },
    {
        "role": "assistant",
        "content": "To create a dynamic HTML table using JavaScript that contains 10 movie titles along with specified columns, and to include functionality for calculating the budget differences and percentage changes, as well as a pivot table for average box office gross per genre, you can follow the below code. This code will cover the creation of the main movie table, calculation of financial metrics, and the generation of a pivot table for the average box office gross by genre.\n\n1. **HTML Structure**: Just create a basic HTML structure with a container where the tables will be appended.\n\n2. **JavaScript Code**: This code will dynamically generate the tables as described.\n\nHere's how you can achieve this:\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Dynamic Movie Table</title>\n    <style>\n        table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-top: 20px;\n        }\n        th, td {\n            border: 1px solid #ddd;\n            padding: 8px;\n            text-align: left;\n        }\n        th {\n            background-color: #f2f2f2;\n        }\n    </style>\n</head>\n<body>\n    <div id=\"table-container\"></div>\n    <script>\n        const movies = [\n            { title: \"The Godfather\", director: \"Francis Ford Coppola\", release_year: 1972, budget: 6, box_office_gross: 246, genre: [\"Crime\", \"Drama\"] },\n            { title: \"Star Wars\", director: \"George Lucas\", release_year: 1977, budget: 11, box_office_gross: 775, genre: [\"Science Fiction\", \"Action\"] },\n            { title: \"Titanic\", director: \"James Cameron\", release_year: 1997, budget: 200, box_office_gross: 2200, genre: [\"Romance\", \"Drama\"] },\n            { title: \"The Shawshank Redemption\", director: \"Frank Darabont\", release_year: 1994, budget: 25, box_office_gross: 58, genre: [\"Drama\"] },\n            { title: \"Pulp Fiction\", director: \"Quentin Tarantino\", release_year: 1994, budget: 8, box_office_gross: 213, genre: [\"Crime\", \"Thriller\"] }\n            // Add more movies as needed\n        ];\n\n        const container = document.getElementById(\"table-container\");\n\n        // Create movie table\n        const movieTable = document.createElement(\"table\");\n        movieTable.id = \"movie-table\";\n\n        const tableHeader = document.createElement(\"thead\");\n        const headerRow = document.createElement(\"tr\");\n        [\"Title\", \"Director\", \"Release Year\", \"Budget\", \"Box Office Gross\", \"Genre\"].forEach(headerText => {\n            const header = document.createElement(\"th\");\n            header.textContent = headerText;\n            headerRow.appendChild(header);\n        });\n        tableHeader.appendChild(headerRow);\n        movieTable.appendChild(tableHeader);\n\n        const tableBody = document.createElement(\"tbody\");\n\n        movies.forEach(movie => {\n            const row = document.createElement(\"tr\");\n            const { title, director, release_year, budget, box_office_gross, genre } = movie;\n            \n            // Calculate budget difference and percentage increase/decrease\n            const difference = box_office_gross - budget;\n            const percentage = Math.round((difference / budget) * 10000) / 100;\n\n            // Create table cells\n            const titleCell = document.createElement(\"td\");\n            titleCell.textContent = title;\n            const directorCell = document.createElement(\"td\");\n            directorCell.textContent = director;\n            const yearCell = document.createElement(\"td\");\n            yearCell.textContent = release_year;\n            const budgetCell = document.createElement(\"td\");\n            budgetCell.textContent = `$${budget}M`;\n            const boxOfficeCell = document.createElement(\"td\");\n            boxOfficeCell.textContent = `$${box_office_gross}M (+$${difference}M, ${percentage >= 0 ? '+' : ''}${percentage}%)`;\n            const genreCell = document.createElement(\"td\");\n            genreCell.textContent = genre.join(\", \");\n\n            // Add cells to row\n            row.appendChild(titleCell);\n            row.appendChild(directorCell);\n            row.appendChild(yearCell);\n            row.appendChild(budgetCell);\n            row.appendChild(boxOfficeCell);\n            row.appendChild(genreCell);\n\n            // Add row to table body\n            tableBody.appendChild(row);\n        });\n\n        movieTable.appendChild(tableBody);\n        container.appendChild(movieTable);\n\n        // Create pivot table for average box office gross by genre\n        const genreData = {};\n\n        movies.forEach(movie => {\n            movie.genre.forEach(genre => {\n                if (!genreData[genre]) {\n                    genreData[genre] = { total: 0, count: 0 };\n                }\n                genreData[genre].total += movie.box_office_gross;\n                genreData[genre].count++;\n            });\n        });\n\n        const pivotTableData = Object.entries(genreData)\n            .map(([genre, data]) => [genre, data.total / data.count])\n            .sort((a, b) => b[1] - a[1]);\n\n        const pivotTable = document.createElement(\"table\");\n        pivotTable.id = \"pivot-table\";\n\n        const pivotTableHeader = document.createElement(\"thead\");\n        const pivotTableHeaderRow = document.createElement(\"tr\");\n        [\"Genre\", \"Average Box Office Gross\"].forEach(headerText => {\n            const header = document.createElement(\"th\");\n            header.textContent = headerText;\n            pivotTableHeaderRow.appendChild(header);\n        });\n        pivotTableHeader.appendChild(pivotTableHeaderRow);\n        pivotTable.appendChild(pivotTableHeader);\n\n        const pivotTableBody = document.createElement(\"tbody\");\n        pivotTableData.forEach(([genre, averageBoxOffice]) => {\n            const row = document.createElement(\"tr\");\n            const genreCell = document.createElement(\"td\");\n            genreCell.textContent = genre;\n            const averageCell = document.createElement(\"td\");\n            averageCell.textContent = `$${averageBoxOffice.toFixed(2)}M`;\n\n            row.appendChild(genreCell);\n            row.appendChild(averageCell);\n            pivotTableBody.appendChild(row);\n        });\n\n        pivotTable.appendChild(pivotTableBody);\n        container.appendChild(pivotTable);\n\n        // Hide pivot table initially\n        pivotTable.style.display = \"none\";\n\n        // Toggle pivot table visibility on button click\n        const toggleButton = document.createElement(\"button\");\n        toggleButton.textContent = \"Toggle Pivot Table\";\n        toggleButton.addEventListener(\"click\", () => {\n            pivotTable.style.display = pivotTable.style.display === \"none\" ? \"\" : \"none\";\n        });\n        container.appendChild(toggleButton);\n    </script>\n</body>\n</html>\n```\n\n### Explanation:\n\n- **Movie Table Creation**: The code dynamically creates a table using DOM methods. The header and rows are constructed based on the `movies` array data.\n\n- **Budget and Box Office Calculations**: For each movie, it calculates the difference between the box office gross and the budget, and computes the percentage change.\n\n- **Pivot Table for Genres**: It aggregates data by genre to compute the average box office gross for each genre. The table is sorted in descending order of average gross.\n\n- **Toggle Functionality**: A button is provided to show/hide the pivot table, allowing dynamic interaction on the page.\n\nThis code should be placed in an HTML file and opened in a browser to see the dynamic table with movies and the calculated metrics."
    }
]