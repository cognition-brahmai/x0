[
    {
        "role": "user",
        "content": "Write a Bash script that monitors CPU usage and sends an alert if it exceeds a specified threshold."
    },
    {
        "role": "assistant",
        "content": "Certainly! Below is a simple Bash script that monitors CPU usage and sends an alert if it exceeds a specified threshold. This script uses the `top` command to get CPU usage and checks it against the threshold.\n\n```bash\n#!/bin/bash\n\n# Set the threshold for CPU usage (in percentage)\nTHRESHOLD=80\n\n# Function to get current CPU usage\nget_cpu_usage() {\n    top -bn1 | grep \"Cpu(s)\" | sed \"s/.*, *\\([0-9.]*\\)%* id.*/\\1/\" | awk '{print 100 - $1}'\n}\n\n# Main loop to monitor CPU usage\nwhile true; do\n    CPU_USAGE=$(get_cpu_usage)\n    if (( $(echo \"$CPU_USAGE > $THRESHOLD\" | bc -l) )); then\n        echo \"Alert: CPU usage is above $THRESHOLD% - Current usage: $CPU_USAGE%\"\n        # Optionally, you can send an email or execute other alert actions here\n    fi\n    # Sleep for a specified interval before checking again\n    sleep 5\ndone\n```\n\n### Explanation:\n1. **Threshold Setting**: The script starts by setting a threshold for CPU usage, in this case, 80%.\n2. **CPU Usage Function**: The `get_cpu_usage` function uses `top -bn1` to get a single batch of output, parses it to find the idle percentage, and calculates the used CPU percentage.\n3. **Monitoring Loop**: The script enters an infinite loop where it checks the CPU usage every 5 seconds (adjustable with the `sleep` command). If the CPU usage exceeds the threshold, it prints an alert message. You can extend this to send emails or perform other actions.\n4. **Alert Mechanism**: Currently, it just prints an alert message. For more robust alerting, you might want to integrate email notifications or use other notification services.\n\n### How to Use:\n1. **Save the Script**: Save the script to a file, for example, `cpu_monitor.sh`.\n2. **Make it Executable**: Run `chmod +x cpu_monitor.sh` to make the script executable.\n3. **Run the Script**: Execute the script with `./cpu_monitor.sh`. It will start monitoring the CPU usage and print alerts when the usage exceeds the specified threshold.\n\nThis script is a basic example and can be expanded with more features like logging, different alert mechanisms, or monitoring specific processes."
    }
]